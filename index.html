<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CraftAI - AI-Powered Marketplace Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;800&family=Playfair+Display:wght@700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        h1, h2, h3, h4, h5, h6 { font-family: 'Playfair Display', serif; }
        .nav-link.active { font-weight: 600; color: #f97316; }
        .prose { max-width: none; }
        ::-webkit-scrollbar { display: none; }
    </style>
    <script>
    const firebaseConfig = {
        apiKey: "AIzaSyA9bskW52C3TCIjM7IYFPf-dcSKA5oWLnc",
        authDomain: "artisan-project-6ce0a.firebaseapp.com",
        projectId: "artisan-project-6ce0a",
        storageBucket: "artisan-project-6ce0a.appspot.com",
        messagingSenderId: "855397761559",
        appId: "1:855397761559:web:9743df91f05cc5931e9252"
    };
    window.__firebase_config = JSON.stringify(firebaseConfig);
    window.__app_id = firebaseConfig.projectId;
    window.__initial_auth_token = ""; 
</script>
</head>
<body class="antialiased text-gray-800 bg-gray-50 flex flex-col min-h-screen">

    <header class="bg-white/80 backdrop-blur-lg shadow-sm sticky top-0 z-40">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center space-x-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 28 28" fill="none" class="text-orange-500">
                        <path d="M13.9999 25.6667C13.9999 25.6667 2.33325 18.6667 2.33325 11.6667C2.33325 4.66668 7.58325 1.16668 13.9999 1.16668C20.4166 1.16668 25.6666 4.66668 25.6666 11.6667C25.6666 18.6667 13.9999 25.6667 13.9999 25.6667Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M14 14m-2.33333 0a2.33333 2.33333 0 1 0 4.66666 0a2.33333 2.33333 0 1 0 -4.66666 0" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <a href="#ai-tools" class="text-xl font-bold text-gray-800">CraftAI</a>
                </div>
                <nav class="hidden md:flex space-x-8">
                    <a href="#ai-tools" class="nav-link text-gray-600 hover:text-orange-500 transition duration-150">AI Tools</a>
                    <a href="#my-products" class="nav-link text-gray-600 hover:text-orange-500 transition duration-150">My Products</a>
                    <a href="#marketplace" class="nav-link text-gray-600 hover:text-orange-500 transition duration-150">Marketplace</a>
                </nav>
            </div>
        </div>
    </header>

    <main class="flex-grow p-8">
        <div id="page-ai-tools">
            <div class="bg-white p-5">
                <div class="container mx-auto grid grid-cols-1 lg:grid-cols-2 gap-12 items-center">
                    <div class="text-center lg:text-left">
                        <span class="inline-flex items-center px-4 py-1 bg-orange-100 text-orange-800 rounded-full text-sm font-semibold mb-4 ring-1 ring-inset ring-orange-200">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" class="mr-2 text-orange-500"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
                            Empowering Traditional Artisans
                        </span>
                        <h2 class="text-4xl md:text-5xl lg:text-6xl font-extrabold text-gray-900 leading-tight">
                            Your <span class="text-orange-500">AI-Powered</span><br/> Marketing <span class="text-teal-600">Assistant</span>
                        </h2>
                        <p class="mt-6 text-lg text-gray-600 max-w-xl mx-auto lg:mx-0">
                            Transform your traditional crafts into compelling digital stories. Generate product descriptions, social media content, and brand narratives that connect your heritage with modern customers.
                        </p>
                        <div class="mt-10 flex gap-4 justify-center lg:justify-start">
                            <a href="#tools-section" class="inline-block bg-orange-500 text-white font-bold text-lg px-8 py-3 rounded-lg shadow-lg hover:bg-orange-600 transition-transform transform hover:-translate-y-1">
                                Start Creating &rarr;
                            </a>
                        </div>
                    </div>
                    <div class="hidden lg:flex items-center justify-center p-8">
                        <div class="bg-white p-6 rounded-2xl shadow-2xl border border-gray-100 transform rotate-3 hover:rotate-0 transition-transform duration-300 ease-in-out w-full max-w-md cursor-pointer group">
                            <div class="flex items-center space-x-3 mb-4">
                                <div class="p-2 bg-orange-100 rounded-full">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-orange-500"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/></svg>
                                </div>
                                <h3 class="font-bold text-lg text-gray-800">Sample Generated Content</h3>
                            </div>
                            <div class="space-y-4">
                                <div class="p-4 bg-gray-50/80 rounded-lg border border-gray-200/50">
                                    <p class="font-semibold text-gray-700 text-sm">Product Description</p>
                                    <p class="text-gray-600 text-sm mt-1">"Handwoven with centuries-old techniques, this vibrant textile tells the story of our village's rich heritage..."</p>
                                </div>
                                <div class="p-4 bg-orange-50/60 rounded-lg border-l-4 border-orange-300">
                                    <p class="font-semibold text-gray-700 text-sm">Social Media Post</p>
                                    <p class="text-gray-600 text-sm mt-1">"üßµ Every thread carries tradition ‚ú® Discover the artistry behind our handloom textiles..."</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="tools-section" class="p-5 container mx-auto">
                 <h3 class="text-3xl text-center font-bold text-gray-900 mb-2">AI-Powered Marketing Tools</h3>
                 <p class="text-center text-gray-600 mb-12 max-w-2xl mx-auto">Transform your craft descriptions into compelling marketing content that resonates with modern customers while honoring your traditional heritage.</p>
                 <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                     <div class="tool-card bg-white p-6 rounded-2xl shadow-lg border-t-4 border-blue-500 text-center">
                        <div class="flex items-center justify-center space-x-3 mb-4">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-blue-500"><path d="M12 3v18M19 12H5"/></svg>
                            <h4 class="text-xl font-bold text-gray-800">Product Description Generator</h4>
                        </div>
                        <p class="text-gray-500 mb-4">Create compelling product descriptions that tell your craft's story.</p>
                        <form id="product-form" class="space-y-4 text-left">
                            <textarea name="features" rows="2" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-orange-500 focus:border-orange-500" placeholder="Describe your product (e.g., 'handwoven silk scarf with traditional block prints')"></textarea>
                            <div class="image-uploader-container">
                                <label class="block text-sm font-medium text-gray-700">Upload Photo (Optional)</label>
                                <input type="file" name="image" class="ai-image-upload mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-orange-50 file:text-orange-700 hover:file:bg-orange-100" accept="image/*">
                                <div class="image-preview-wrapper mt-2 hidden text-center">
                                    <img class="image-preview rounded-lg max-h-32 inline-block" src="" alt="Image preview">
                                    <button type="button" class="remove-ai-image-btn mt-2 block w-full text-sm text-red-600 hover:text-red-800">Remove Image</button>
                                </div>
                            </div>
                            <div>
                                <label for="product-language" class="block text-sm font-medium text-gray-700">Output Language</label>
                                <select id="product-language" name="language" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-orange-500 focus:border-orange-500">
                                    <option>English</option>
                                    <option>Hindi (‡§π‡§ø‡§®‡•ç‡§¶‡•Ä)</option>
                                    <option>Bengali (‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ)</option>
                                    <option>Tamil (‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç)</option>
                                    <option>Marathi (‡§Æ‡§∞‡§æ‡§†‡•Ä)</option>
                                    <option>Telugu (‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å)</option>
                                    <option>Kannada (‡≤ï‡≤®‡≥ç‡≤®‡≤°)</option>
                                </select>
                            </div>
                            <button type="submit" class="w-full bg-orange-500 hover:bg-orange-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition transform hover:scale-105 disabled:opacity-50">Generate Description</button>
                            <div class="output-display mt-4 text-left">
                                <div class="bg-gray-100 p-4 rounded-lg min-h-[120px] max-h-48 overflow-y-auto text-sm text-gray-700 relative">
                                    <button type="button" class="copy-btn absolute top-2 right-2 text-gray-400 hover:text-orange-500" aria-label="Copy">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="14" height="14" x="8" y="8" rx="2" ry="2" /><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2" /></svg>
                                    </button>
                                    <div class="prose prose-sm" id="product-output">Your compelling product description will appear here...</div>
                                </div>
                            </div>
                        </form>
                    </div>

                    <div class="tool-card bg-white p-6 rounded-2xl shadow-lg border-t-4 border-green-500 text-center">
                        <div class="flex items-center justify-center space-x-3 mb-4">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-green-500"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg>
                            <h4 class="text-xl font-bold text-gray-800">Social Media Post Creator</h4>
                        </div>
                        <p class="text-gray-500 mb-4">Generate engaging social media content with hashtags and emojis.</p>
                        <form id="social-form" class="space-y-4 text-left">
                            <textarea name="product" rows="2" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-orange-500 focus:border-orange-500" placeholder="What craft or product do you want to promote?"></textarea>
                            <div class="image-uploader-container">
                                <label class="block text-sm font-medium text-gray-700">Upload Photo (Optional)</label>
                                <input type="file" name="image" class="ai-image-upload mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-orange-50 file:text-orange-700 hover:file:bg-orange-100" accept="image/*">
                                <div class="image-preview-wrapper mt-2 hidden text-center">
                                    <img class="image-preview rounded-lg max-h-32 inline-block" src="" alt="Image preview">
                                    <button type="button" class="remove-ai-image-btn mt-2 block w-full text-sm text-red-600 hover:text-red-800">Remove Image</button>
                                </div>
                            </div>
                             <div>
                                <label for="social-language" class="block text-sm font-medium text-gray-700">Output Language</label>
                                <select id="social-language" name="language" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-orange-500 focus:border-orange-500">
                                    <option>English</option>
                                    <option>Hindi (‡§π‡§ø‡§®‡•ç‡§¶‡•Ä)</option>
                                </select>
                            </div>
                            <input type="hidden" name="platform" value="Instagram">
                            <button type="submit" class="w-full bg-orange-500 hover:bg-orange-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition transform hover:scale-105 disabled:opacity-50">Create Post</button>
                            <div class="output-display mt-4 text-left">
                                <div class="bg-gray-100 p-4 rounded-lg min-h-[120px] max-h-48 overflow-y-auto text-sm text-gray-700 relative">
                                    <button type="button"="copy-btn absolute top-2 right-2 text-gray-400 hover:text-orange-500" aria-label="Copy">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="14" height="14" x="8" y="8" rx="2" ry="2" /><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2" /></svg>
                                    </button>
                                    <pre class="whitespace-pre-wrap font-sans" id="social-output">Your engaging social media post will appear here...</pre>
                                </div>
                            </div>
                        </form>
                    </div>

                    <div class="tool-card bg-white p-6 rounded-2xl shadow-lg border-t-4 border-purple-500 text-center">
                        <div class="flex items-center justify-center space-x-3 mb-4">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-purple-500"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
                            <h4 class="text-xl font-bold text-gray-800">Brand Story Writer</h4>
                        </div>
                        <p class="text-gray-500 mb-4">Craft your unique artisan story and brand narrative.</p>
                        <form id="story-form" class="space-y-4 text-left">
                            <textarea name="special" rows="2" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-orange-500 focus:border-orange-500" placeholder="Tell us about your craft, family tradition, or artisan journey."></textarea>
                            <div class="image-uploader-container">
                                <label class="block text-sm font-medium text-gray-700">Upload Photo (Optional)</label>
                                <input type="file" name="image" class="ai-image-upload mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-orange-50 file:text-orange-700 hover:file:bg-orange-100" accept="image/*">
                                <div class="image-preview-wrapper mt-2 hidden text-center">
                                    <img class="image-preview rounded-lg max-h-32 inline-block" src="" alt="Image preview">
                                    <button type="button" class="remove-ai-image-btn mt-2 block w-full text-sm text-red-600 hover:text-red-800">Remove Image</button>
                                </div>
                            </div>
                            <div>
                                <label for="story-language" class="block text-sm font-medium text-gray-700">Output Language</label>
                                <select id="story-language" name="language" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-orange-500 focus:border-orange-500">
                                    <option>English</option>
                                    <option>Hindi (‡§π‡§ø‡§®‡•ç‡§¶‡•Ä)</option>
                                </select>
                            </div>
                            <button type="submit" class="w-full bg-orange-500 hover:bg-orange-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition transform hover:scale-105 disabled:opacity-50">Write My Story</button>
                            <div class="output-display mt-4 text-left">
                                <div class="bg-gray-100 p-4 rounded-lg min-h-[120px] max-h-48 overflow-y-auto text-sm text-gray-700 relative">
                                    <button type="button" class="copy-btn absolute top-2 right-2 text-gray-400 hover:text-orange-500" aria-label="Copy">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="14" height="14" x="8" y="8" rx="2" ry="2" /><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2" /></svg>
                                    </button>
                                    <div class="prose prose-sm" id="story-output">Your beautiful artisan story will appear here...</div>
                                </div>
                            </div>
                        </form>
                    </div>

                    <div class="tool-card bg-white p-6 rounded-2xl shadow-lg border-t-4 border-amber-500 text-center">
                        <div class="flex items-center justify-center space-x-3 mb-4">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-amber-500"><path d="m13 2-3 14 3 6 3-6-3-14Z"/><path d="M2 17h20"/><path d="M17 17a5 5 0 0 0-10 0"/></svg>
                            <h4 class="text-xl font-bold text-gray-800">Marketing Copy Generator</h4>
                        </div>
                        <p class="text-gray-500 mb-4">Create promotional content and sales copy for your products.</p>
                        <form id="marketing-form" class="space-y-4 text-left">
                            <textarea name="product" rows="2" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-orange-500 focus:border-orange-500" placeholder="What product or service do you want to create marketing copy for?"></textarea>
                            <div class="image-uploader-container">
                                <label class="block text-sm font-medium text-gray-700">Upload Photo (Optional)</label>
                                <input type="file" name="image" class="ai-image-upload mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-orange-50 file:text-orange-700 hover:file:bg-orange-100" accept="image/*">
                                <div class="image-preview-wrapper mt-2 hidden text-center">
                                    <img class="image-preview rounded-lg max-h-32 inline-block" src="" alt="Image preview">
                                    <button type="button" class="remove-ai-image-btn mt-2 block w-full text-sm text-red-600 hover:text-red-800">Remove Image</button>
                                </div>
                            </div>
                            <div>
                                <label for="marketing-language" class="block text-sm font-medium text-gray-700">Output Language</label>
                                <select id="marketing-language" name="language" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-orange-500 focus:border-orange-500">
                                    <option>English</option>
                                    <option>Hindi (‡§π‡§ø‡§®‡•ç‡§¶‡•Ä)</option>
                                </select>
                            </div>
                            <button type="submit" class="w-full bg-orange-500 hover:bg-orange-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition transform hover:scale-105 disabled:opacity-50">Generate Marketing Copy</button>
                            <div class="output-display mt-4 text-left">
                                <div class="bg-gray-100 p-4 rounded-lg min-h-[120px] max-h-48 overflow-y-auto text-sm text-gray-700 relative">
                                    <button type="button" class="copy-btn absolute top-2 right-2 text-gray-400 hover:text-orange-500" aria-label="Copy">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="14" height="14" x="8" y="8" rx="2" ry="2" /><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2" /></svg>
                                    </button>
                                    <div class="prose prose-sm" id="marketing-output">Your compelling marketing copy will appear here...</div>
                                </div>
                            </div>
                        </form>
                    </div>
                 </div>
            </div>
        </div>

        <div id="page-my-products" class="hidden">
             <section class="container mx-auto p-5">
                <div class="text-center mb-12">
                    <h2 class="text-4xl md:text-5xl font-bold text-gray-900 leading-tight">My Products</h2>
                    <p class="mt-4 text-lg text-gray-600 max-w-3xl mx-auto">Add new products to the marketplace and manage your listings.</p>
                </div>
                <div class="grid lg:grid-cols-3 gap-8">
                    <div class="lg:col-span-1">
                        <div class="bg-white p-8 rounded-2xl shadow-lg border border-gray-200 sticky top-24">
                            <h3 class="text-2xl font-bold text-gray-900 mb-6">List a New Product</h3>
                            <form id="list-product-form" class="space-y-4">
                                <div>
                                    <label for="marketplace-name" class="block text-sm font-medium text-gray-700">Product Name</label>
                                    <input type="text" id="marketplace-name" name="name" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-orange-500 focus:border-orange-500" />
                                </div>
                                <div>
                                    <label for="marketplace-price" class="block text-sm font-medium text-gray-700">Price (‚Çπ)</label>
                                    <input type="number" id="marketplace-price" name="price" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-orange-500 focus:border-orange-500" />
                                </div>
                                <div>
                                    <label for="marketplace-description" class="block text-sm font-medium text-gray-700">Description</label>
                                    <textarea id="marketplace-description" name="description" rows="4" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-orange-500 focus:border-orange-500"></textarea>
                                </div>
                                <div>
                                    <label for="marketplace-image" class="block text-sm font-medium text-gray-700">Product Image</label>
                                    <input type="file" id="marketplace-image" name="image" accept="image/*" required class="mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-orange-50 file:text-orange-700 hover:file:bg-orange-100" />
                                </div>
                                <button type="submit" class="w-full bg-orange-500 hover:bg-orange-600 text-white font-bold py-3 px-4 rounded-lg shadow-md transition transform hover:scale-105">List Product</button>
                            </form>
                        </div>
                    </div>
                    <div id="my-products-grid" class="lg:col-span-2 grid sm:grid-cols-2 gap-8 items-start">
                        </div>
                </div>
            </section>
        </div>

        <div id="page-marketplace" class="hidden">
            <section class="container mx-auto p-5">
                <div class="text-center mb-12">
                    <h2 class="text-4xl md:text-5xl font-bold text-gray-900 leading-tight">Community Marketplace</h2>
                    <p class="mt-4 text-lg text-gray-600 max-w-3xl mx-auto">Discover unique, handcrafted products from talented artisans across India.</p>
                </div>
                <div id="marketplace-grid" class="grid sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8">
                   </div>
            </section>
        </div>
        
        <div id="page-product-detail" class="hidden">
            </div>
    </main>
    
    <div id="toast-container" class="fixed bottom-10 left-1/2 -translate-x-1/2 z-50"></div>

    <footer class="bg-gray-800 text-white mt-auto">
        <div class="container mx-auto py-6 px-4 text-center text-gray-500 text-sm">
            <p>&copy; 2025 CraftAI. Proudly supporting Indian artisan communities.</p>
        </div>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.7.3/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.7.3/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, doc, deleteDoc, query } from "https://www.gstatic.com/firebasejs/11.7.3/firebase-firestore.js";

        // --- GLOBAL STATE & CONFIG ---
        const API_KEY = "AIzaSyDTckl0yq1jxS-3uhuYNO6xSIhinjbjn8s"; 
        let db, auth, userId;
        window.liveProducts = [];
        let uploadedImageDataForAI = null;

        const sampleProducts = [
             { id: 'sample1', name: 'Hand-Painted Madhubani Art', price: '1500', originalPrice: '1999', category: 'Paintings & Art', rating: 4.8, reviewCount: 112, description: 'A beautiful piece of traditional Madhubani art from Bihar, depicting nature and mythology. Perfect for home decor.', image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRMzrg7xpgyEC0yf4f-JXwNkPNNiBXMJjqPjw&s', ownerId: 'sampleOwner' },
             { id: 'sample2', name: 'Blue Pottery Ceramic Vase', price: '2500', originalPrice: '3200', category: 'Home Decor', rating: 4.6, reviewCount: 89, description: 'Exquisite Blue Pottery vase from Jaipur, handcrafted with a unique Persian-influenced art form. A vibrant addition to any room.', image: 'https://upload.wikimedia.org/wikipedia/commons/thumb/1/16/Blue_pottery_pilgrim_flask.jpg/640px-Blue_pottery_pilgrim_flask.jpg', ownerId: 'sampleOwner' },
             { id: 'sample3', name: 'Pashmina Shawl with Sozni Embroidery', price: '8000', originalPrice: '10500', category: 'Apparel & Textiles', rating: 4.9, reviewCount: 204, description: 'An authentic, handwoven Pashmina shawl from Kashmir, featuring delicate Sozni needlework. A luxurious and timeless piece.', image: 'https://m.media-amazon.com/images/I/41+LRdUxrCL._UY1100_.jpg', ownerId: 'sampleOwner' },
             { id: 'sample4', name: 'Terracotta Horse Figurine', price: '950', originalPrice: '1235', category: 'Sculptures & Figurines', rating: 4.4, reviewCount: 67, description: 'A rustic Terracotta horse from Panchmura, West Bengal, symbolizing power and grace. Ideal for traditional and modern interiors. Crafted using techniques passed down through generations of skilled potters.', image: 'https://m.media-amazon.com/images/I/713Etk0OVdL._UF894,1000_QL80_.jpg', ownerId: 'sampleOwner' }
        ];

        // --- AI CONTENT GENERATION ---
        async function generateContent(form, systemInstruction, userQuery, isHtml = false, imageData = null) {
            const submitBtn = form.querySelector('button[type="submit"]');
            const outputElement = form.querySelector('[id$="-output"]');
            
            const originalText = submitBtn.dataset.originalText || submitBtn.textContent;
            submitBtn.textContent = 'Generating...';
            submitBtn.disabled = true;
            
            try {
                const requestBody = {
                    contents: [{
                        parts: [
                            { text: systemInstruction + "\n\nUser request: " + userQuery }
                        ]
                    }],
                    generationConfig: {
                        temperature: 0.7,
                        topK: 40,
                        topP: 0.95,
                        maxOutputTokens: 1024,
                    },
                    safetySettings: [
                        { category: "HARM_CATEGORY_HARASSMENT", threshold: "BLOCK_MEDIUM_AND_ABOVE" },
                        { category: "HARM_CATEGORY_HATE_SPEECH", threshold: "BLOCK_MEDIUM_AND_ABOVE" },
                        { category: "HARM_CATEGORY_SEXUALLY_EXPLICIT", threshold: "BLOCK_MEDIUM_AND_ABOVE" },
                        { category: "HARM_CATEGORY_DANGEROUS_CONTENT", threshold: "BLOCK_MEDIUM_AND_ABOVE" }
                    ]
                };

                // Add image if provided
                if (imageData) {
                    requestBody.contents[0].parts.unshift({
                        inlineData: {
                            mimeType: imageData.mimeType,
                            data: imageData.data
                        }
                    });
                }

                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestBody)
                });

                if (!response.ok) {
                    throw new Error(`API Error: ${response.status}`);
                }

                const data = await response.json();
                
                if (data.candidates && data.candidates[0] && data.candidates[0].content && data.candidates[0].content.parts) {
                    const generatedText = data.candidates[0].content.parts[0].text;
                    
                    if (isHtml) {
                        outputElement.innerHTML = generatedText.replace(/\n/g, '<br>');
                    } else {
                        outputElement.textContent = generatedText;
                    }
                    
                    showToast('Content generated successfully!');
                } else {
                    throw new Error('No content generated');
                }
                
            } catch (error) {
                console.error('Error generating content:', error);
                outputElement.textContent = 'Sorry, there was an error generating content. Please try again.';
                showToast('Error generating content. Please check your internet connection and try again.');
            } finally {
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }
        }

        // --- UI ELEMENTS ---
        const pages = {
            'ai-tools': document.getElementById('page-ai-tools'),
            'my-products': document.getElementById('page-my-products'),
            'marketplace': document.getElementById('page-marketplace'),
            'product-detail': document.getElementById('page-product-detail'),
        };
        const navLinks = document.querySelectorAll('.nav-link');
        const myProductsGrid = document.getElementById('my-products-grid');
        const marketplaceGrid = document.getElementById('marketplace-grid');
        
        // --- TOAST NOTIFICATION ---
        function showToast(message) {
             const toastContainer = document.getElementById('toast-container');
             const toast = document.createElement('div');
             toast.className = 'bg-gray-800 text-white px-6 py-2 rounded-full shadow-lg';
             toast.textContent = message;
             toastContainer.appendChild(toast);
             setTimeout(() => toast.remove(), 3000);
        }

        // --- ROUTING ---
        function handleRouting() {
            const hash = window.location.hash.substring(1) || 'ai-tools';
            const [page, id] = hash.split('/');
            Object.values(pages).forEach(p => p.classList.add('hidden'));
            if (page === 'product' && id) {
                pages['product-detail'].classList.remove('hidden');
                renderProductDetail(id);
            } else if (pages[page]) {
                pages[page].classList.remove('hidden');
            } else {
                pages['ai-tools'].classList.remove('hidden'); 
            }
            const activePage = (page === 'product') ? 'marketplace' : page;
            navLinks.forEach(link => {
                link.classList.toggle('active', link.getAttribute('href') === `#${activePage}`);
            });
        }
        
        // --- DATA RENDERING ---
        function renderProducts(allProducts) {
            myProductsGrid.innerHTML = '';
            marketplaceGrid.innerHTML = '';
            const myProducts = allProducts.filter(p => p.ownerId === userId);
            const marketplaceItems = allProducts.length > 0 ? allProducts : sampleProducts;
            if (marketplaceItems.length === 0) {
                 marketplaceGrid.innerHTML = createEmptyState("The marketplace is empty", "Be the first to list a product!");
            } else {
                marketplaceItems.forEach(product => marketplaceGrid.appendChild(createProductCard(product)));
            }
            if (myProducts.length === 0) {
                myProductsGrid.innerHTML = `<p class="lg:col-span-2 text-center text-gray-500">You haven't listed any products yet. Sample products are shown below for demonstration.</p>`;
                sampleProducts.forEach(product => myProductsGrid.appendChild(createProductCard(product, false)));
            } else {
                myProducts.forEach(product => myProductsGrid.appendChild(createProductCard(product, true)));
            }
        }

        function createProductCard(product, canDelete = false) {
            const cardWrapper = document.createElement('div');
            cardWrapper.className = 'relative group'; 
            const cardLink = document.createElement('a');
            cardLink.href = `#product/${product.id}`;
            cardLink.className = 'bg-white rounded-2xl shadow-lg overflow-hidden block transform group-hover:-translate-y-1 transition-transform duration-300 border border-gray-200 flex flex-col h-full';
            cardLink.innerHTML = `
                <img class="h-56 w-full object-cover" src="${product.image}" alt="${product.name}" />
                <div class="p-5 flex flex-col flex-grow">
                    <h4 class="text-lg font-bold text-gray-800">${product.name}</h4>
                    <p class="mt-2 text-gray-500 text-sm flex-grow">${product.description.substring(0, 100)}...</p>
                    <div class="mt-4 flex justify-between items-center">
                        <p class="font-bold text-orange-500 text-xl">‚Çπ${product.price}</p>
                    </div>
                </div>
            `;
            cardWrapper.appendChild(cardLink);
            if (canDelete) {
                const deleteButton = document.createElement('button');
                deleteButton.dataset.id = product.id;
                deleteButton.className = 'delete-btn absolute top-3 right-3 bg-white/70 backdrop-blur-sm p-2 rounded-full text-gray-500 hover:text-red-500 hover:bg-red-100 transition-colors z-10';
                deleteButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18" /><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" /><line x1="10" x2="10" y1="11" y2="17" /><line x1="14" x2="14" y1="11" y2="17" /></svg>`;
                cardWrapper.appendChild(deleteButton);
            }
            return cardWrapper;
        }

        function renderProductDetail(productId) {
            const allAvailableProducts = [...window.liveProducts, ...sampleProducts];
            const product = allAvailableProducts.find(p => p.id === productId);
            const container = pages['product-detail'];
            if (!product) {
                container.innerHTML = createEmptyState("Product Not Found", "The product you're looking for doesn't exist.");
                return;
            }
            const discount = product.originalPrice ? Math.round(((product.originalPrice - product.price) / product.originalPrice) * 100) : 0;
            const ratingStars = Array(5).fill(0).map((_, i) => `<svg class="${i < Math.round(product.rating) ? 'text-yellow-400' : 'text-gray-300'}" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>`).join('');
            container.innerHTML = `
                <section class="container mx-auto p-5">
                    <div class="mb-6">
                        <a href="#marketplace" class="text-orange-500 hover:text-orange-600 font-semibold inline-flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><path d="m15 18-6-6 6-6"/></svg>
                            Back to Marketplace
                        </a>
                    </div>
                    <div class="bg-white rounded-2xl shadow-xl border border-gray-200 p-8 grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-12">
                        <div class="flex items-center justify-center">
                            <img class="w-full object-cover rounded-lg shadow-md" src="${product.image}" alt="${product.name}" style="max-width: 660.4px; height: 500px;">
                        </div>
                        <div class="flex flex-col">
                            <h2 class="text-3xl lg:text-4xl font-bold text-gray-900 leading-tight">${product.name}</h2>
                            <p class="text-gray-500 mt-1">${product.category || 'Handcrafted Art'}</p>
                            <div class="mt-2 flex items-center space-x-2">
                                <div class="flex">${ratingStars}</div>
                                <span class="font-semibold text-gray-700">${product.rating}</span>
                                <span class="text-sm text-gray-500">(${product.reviewCount} reviews)</span>
                            </div>
                            <div class="my-4 flex items-baseline space-x-3">
                                <p class="text-3xl font-bold text-orange-500">‚Çπ${product.price}</p>
                                ${product.originalPrice ? `<s class="text-gray-400">‚Çπ${product.originalPrice}</s>` : ''}
                                ${discount > 0 ? `<span class="text-green-600 font-semibold bg-green-100 px-2 py-1 rounded-md text-sm">${discount}% off</span>` : ''}
                            </div>
                            <p class="text-sm text-gray-500 -mt-2">Inclusive of all taxes</p>
                            <div class="mt-6">
                                <h3 class="font-bold text-gray-800">Product Description</h3>
                                <p class="prose text-gray-600 mt-2">${product.description}</p>
                            </div>
                            <div class="mt-8 flex space-x-4">
                                <button class="w-full bg-white text-orange-600 font-bold py-3 px-4 rounded-lg hover:bg-orange-50 ring-1 ring-inset ring-orange-200 transition flex items-center justify-center space-x-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/></svg>
                                    <span>Add to Cart</span>
                                </button>
                                <button class="w-full bg-orange-500 hover:bg-orange-600 text-white font-bold py-3 px-4 rounded-lg shadow-md transition transform hover:scale-105">Buy Now</button>
                            </div>
                            <div class="mt-8 pt-6 border-t border-gray-200 grid grid-cols-3 gap-4 text-center">
                                <div class="flex flex-col items-center text-gray-500">
                                     <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="text-green-500"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
                                    <span class="text-xs mt-1 font-medium">Authentic Products</span>
                                </div>
                                <div class="flex flex-col items-center text-gray-500">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="text-blue-500"><rect x="1" y="3" width="15" height="13"/><polygon points="16 8 20 8 23 11 23 16 16 16 16 8"/><circle cx="5.5" cy="18.5" r="2.5"/><circle cx="18.5" cy="18.5" r="2.5"/></svg>
                                    <span class="text-xs mt-1 font-medium">Free Shipping</span>
                                </div>
                                <div class="flex flex-col items-center text-gray-500">
                                     <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="text-purple-500"><path d="M15 2.13a2.4 2.4 0 0 1 3.24 0l3.5 3.5a2.4 2.4 0 0 1 0 3.24l-8.5 8.5c-.3.3-.7.5-1.1.5h-4.33a1 1 0 0 1-1-1v-4.33c0-.4.2-.8.5-1.1z"/><path d="m10.5 5.5 8 8"/></svg>
                                    <span class="text-xs mt-1 font-medium">Easy Returns</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-2xl shadow-xl border border-gray-200 p-8 mt-8">
                        <h3 class="text-2xl font-bold text-gray-900 mb-6">Customer Reviews</h3>
                        <div id="reviews-list">
                            <div class="text-center py-8 text-gray-500"><p>There are no reviews for this product yet.</p></div>
                        </div>
                    </div>
                </section>
            `;
        }

        function createEmptyState(title, subtitle) {
            return `<div class="col-span-full text-center py-12 bg-white rounded-2xl shadow-lg border border-gray-200">
                        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="mx-auto text-gray-400"><path d="M21 10.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5Z" /></svg>
                        <h3 class="mt-2 text-lg font-medium text-gray-900">${title}</h3>
                        <p class="mt-1 text-sm text-gray-500">${subtitle}</p>
                    </div>`;
        }
        
        async function handleDeleteProduct(id) {
            if (!db || !id) return;
            if (id.startsWith('sample')) {
                showToast("Sample products cannot be deleted.");
                return;
            }
            if (confirm("Are you sure you want to delete this product?")) {
                try {
                    const appId = window.__app_id || 'default-app-id';
                    const productDocRef = doc(db, `artifacts/${appId}/public/data/products`, id);
                    await deleteDoc(productDocRef);
                    showToast("Product deleted successfully.");
                } catch (error) {
                    console.error("Error deleting product: ", error);
                    showToast("Error deleting product.");
                }
            }
        }

        // --- IMAGE HANDLING ---
        function clearAllAIImageUploaders(exceptThisInput = null) {
            document.querySelectorAll('.ai-image-upload').forEach(input => {
                if (input !== exceptThisInput) {
                    input.value = '';
                    const wrapper = input.closest('.image-uploader-container').querySelector('.image-preview-wrapper');
                    if (wrapper) {
                        wrapper.classList.add('hidden');
                        wrapper.querySelector('.image-preview').src = '';
                    }
                }
            });
        }

        // --- CLIPBOARD ---
        function copyToClipboard(element) {
            const textToCopy = element.tagName === 'PRE' ? element.textContent : element.innerText;
            navigator.clipboard.writeText(textToCopy).then(() => {
                showToast('Copied to clipboard!');
            }).catch(err => {
                console.error('Failed to copy text: ', err);
                showToast('Failed to copy.');
            });
        }
        
        // --- INITIALIZATION ---
        function init() {
            window.addEventListener('hashchange', handleRouting);
            handleRouting();

            try {
                const firebaseConfig = JSON.parse(window.__firebase_config);
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        userId = user.uid;
                        const appId = window.__app_id || 'default-app-id';
                        const productsCollectionRef = collection(db, `artifacts/${appId}/public/data/products`);
                        onSnapshot(query(productsCollectionRef), (snapshot) => {
                            const productsData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                            window.liveProducts = productsData;
                            renderProducts(productsData);
                            handleRouting(); 
                        });
                    } else {
                        userId = null;
                        window.liveProducts = [];
                        renderProducts([]);
                        signInAnonymously(auth);
                    }
                });
            } catch (error) {
                console.error("Firebase Initialization Error:", error);
                showToast("Could not connect to the database.");
                renderProducts([]);
            }
            
            document.body.addEventListener('change', (e) => {
                if (e.target.classList.contains('ai-image-upload')) {
                    const file = e.target.files[0];
                    const previewWrapper = e.target.closest('.image-uploader-container').querySelector('.image-preview-wrapper');
                    const previewImg = previewWrapper.querySelector('.image-preview');
                    clearAllAIImageUploaders(e.target);
                    if (file) {
                        const reader = new FileReader();
                        reader.onloadend = () => {
                            previewImg.src = reader.result;
                            previewWrapper.classList.remove('hidden');
                            uploadedImageDataForAI = {
                                mimeType: file.type,
                                data: reader.result.split(',')[1]
                            };
                        };
                        reader.readAsDataURL(file);
                    } else {
                        uploadedImageDataForAI = null;
                        previewWrapper.classList.add('hidden');
                    }
                }
            });

            document.getElementById('product-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const form = e.target;
                const features = form.elements.features.value;
                const language = form.elements.language.value;
                if (!features && !uploadedImageDataForAI) return showToast("Please describe your product or upload an image.");
                let userQuery = `Generate a product description in ${language} for: "${features}"`;
                if (uploadedImageDataForAI && !features) { userQuery = `Generate a product description in ${language} for the product in this image.`; }
                else if (uploadedImageDataForAI && features) { userQuery = `Using the product in this image as a visual reference, generate a product description in ${language} for: "${features}"`; }
                const systemInstruction = "You are an expert e-commerce copywriter specializing in traditional Indian handicrafts. Create compelling, authentic product descriptions that highlight craftsmanship, cultural heritage, and quality. Focus on storytelling that connects the buyer to the artisan's work.";
                form.querySelector('button[type="submit"]').dataset.originalText = "Generate Description";
                generateContent(form, systemInstruction, userQuery, true, uploadedImageDataForAI);
            });

            document.getElementById('social-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const form = e.target;
                const product = form.elements.product.value;
                const language = form.elements.language.value;
                if (!product && !uploadedImageDataForAI) return showToast("Please describe the product or upload an image.");
                let userQuery = `Create a social media post in ${language} about "${product}".`;
                if (uploadedImageDataForAI && !product) { userQuery = `Create a social media post in ${language} for the product in this image.`; }
                else if (uploadedImageDataForAI && product) { userQuery = `Using the product in this image as a visual reference, create a social media post in ${language} about "${product}".`; }
                const systemInstruction = `You are a savvy social media marketer for handcrafted products. Create engaging posts with relevant hashtags, emojis, and compelling copy that showcases the beauty and tradition behind artisan products. Make it Instagram-ready with proper formatting.`;
                form.querySelector('button[type="submit"]').dataset.originalText = "Create Post";
                generateContent(form, systemInstruction, userQuery, false, uploadedImageDataForAI);
            });
            
            document.getElementById('story-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const form = e.target;
                const special = form.elements.special.value;
                const language = form.elements.language.value;
                if (!special && !uploadedImageDataForAI) return showToast("Please describe your journey or upload an image.");
                let userQuery = `Write a story in ${language} about an artisan whose special craft is: "${special}".`;
                if (uploadedImageDataForAI && !special) { userQuery = `Write a brand story in ${language} inspired by the artisan's work in this image.`; }
                else if (uploadedImageDataForAI && special) { userQuery = `Using the work in this image as a visual reference, write a story in ${language} about an artisan whose special craft is: "${special}".`; }
                const systemInstruction = `You are a gifted storyteller who specializes in crafting authentic narratives about traditional artisans and their heritage crafts. Create compelling brand stories that honor cultural traditions while appealing to modern customers. Focus on the human element, family traditions, and the passion behind the craft.`;
                form.querySelector('button[type="submit"]').dataset.originalText = "Write My Story";
                generateContent(form, systemInstruction, userQuery, true, uploadedImageDataForAI);
            });

            document.getElementById('marketing-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const form = e.target;
                const product = form.elements.product.value;
                const language = form.elements.language.value;
                if (!product && !uploadedImageDataForAI) return showToast("Please provide a product or upload an image.");
                let userQuery = `Write marketing copy in ${language} for a product: "${product}".`;
                if (uploadedImageDataForAI && !product) { userQuery = `Write marketing copy in ${language} for the product in this image.`; }
                else if (uploadedImageDataForAI && product) { userQuery = `Using the product in this image as a visual reference, write marketing copy in ${language} for: "${product}".`; }
                const systemInstruction = `You are a marketing copywriter specializing in artisan products. Create persuasive, compelling marketing copy that emphasizes quality, authenticity, and the unique value proposition of handcrafted items. Use emotional appeal while highlighting practical benefits.`;
                form.querySelector('button[type="submit"]').dataset.originalText = "Generate Marketing Copy";
                generateContent(form, systemInstruction, userQuery, true, uploadedImageDataForAI);
            });

            document.getElementById('list-product-form').addEventListener('submit', (e) => {
                e.preventDefault();
                if (!userId || !db) return showToast("You must be signed in to list products.");
                const form = e.target;
                const { name, price, description, image } = form.elements;
                const imageFile = image.files[0];
                if(imageFile) {
                    const reader = new FileReader();
                    reader.onload = async (event) => {
                        const newProduct = {
                            name: name.value, price: price.value, description: description.value,
                            image: event.target.result, ownerId: userId, createdAt: new Date()
                        };
                        try {
                            const appId = window.__app_id || 'default-app-id';
                            const productsCollectionRef = collection(db, `artifacts/${appId}/public/data/products`);
                            await addDoc(productsCollectionRef, newProduct);
                            showToast("Product listed successfully!");
                            form.reset();
                        } catch (error) {
                            console.error("Error adding product: ", error);
                            showToast("Error listing product.");
                        }
                    }
                    reader.readAsDataURL(imageFile);
                }
            });
            
            document.body.addEventListener('click', (e) => {
                if (e.target.closest('.copy-btn')) {
                    const outputElement = e.target.closest('.output-display').querySelector('[id$="-output"]');
                    copyToClipboard(outputElement);
                }
                if (e.target.closest('.delete-btn')) {
                    const id = e.target.closest('.delete-btn').dataset.id;
                    handleDeleteProduct(id);
                }
                if (e.target.closest('.remove-ai-image-btn')) {
                    clearAllAIImageUploaders();
                    uploadedImageDataForAI = null;
                }
            });
        }
        
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
